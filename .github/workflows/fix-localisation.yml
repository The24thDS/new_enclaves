name: Fix localisation
on:
  workflow_dispatch
jobs:
  cancel:
    name: 'Cancel Previous Runs'
    runs-on: ubuntu-latest
    timeout-minutes: 3
    steps:
      - uses: styfle/cancel-workflow-action@0.9.1
        with:
          all_but_latest: true
          access_token: ${{ secrets.GITHUB_TOKEN }}
  fix_localisation:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0 # otherwise, you will failed to push refs to dest repo
    - name: Fix locs
      run: |
        chmod +x ./fix_crowdin_localisation_files.sh
        ./fix_crowdin_localisation_files.sh new_enclaves
        git config --global --add safe.directory /github/workspace
    - name: Check if there are changes
      id: changes
      uses: UnicornGlobal/has-changes-action@v1.0.11
    - name: Commit files
      if: steps.changes.outputs.changed == 1
      run: |
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add .
        git commit -m "Autofix for localisation files"
        git push



